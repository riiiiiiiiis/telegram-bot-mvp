# Деплой Telegram Bot на Railway

Это руководство поможет вам задеплоить Telegram-бота для сбора сообщений на платформу Railway.

## Подготовка к деплою

### 1. Создание бота в Telegram

1. Откройте чат с [@BotFather](https://t.me/BotFather)
2. Создайте нового бота командой `/newbot`
3. Следуйте инструкциям и получите токен бота
4. **ВАЖНО**: Отключите Privacy Mode командой `/setprivacy` → выберите бота → `Disable`

### 2. Подготовка базы данных PostgreSQL

Railway предоставляет встроенную PostgreSQL базу данных:

1. В проекте Railway добавьте PostgreSQL сервис
2. Railway автоматически создаст переменную `DATABASE_URL`
3. Таблицы создадутся автоматически при первом запуске бота

## Деплой на Railway

### Способ 1: Через GitHub (Рекомендуется)

1. **Загрузите код в GitHub репозиторий**
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git branch -M main
   git remote add origin https://github.com/yourusername/telegram-bot.git
   git push -u origin main
   ```

2. **Создайте проект на Railway**
   - Зайдите на [railway.app](https://railway.app)
   - Нажмите "New Project"
   - Выберите "Deploy from GitHub repo"
   - Выберите ваш репозиторий

3. **Добавьте PostgreSQL**
   - В проекте нажмите "New Service"
   - Выберите "Database" → "PostgreSQL"
   - Railway автоматически создаст `DATABASE_URL`

4. **Настройте переменные окружения**
   - Перейдите в настройки вашего сервиса
   - Добавьте переменную `TELEGRAM_TOKEN` со значением токена вашего бота

### Способ 2: Через Railway CLI

1. **Установите Railway CLI**
   ```bash
   npm install -g @railway/cli
   ```

2. **Войдите в аккаунт**
   ```bash
   railway login
   ```

3. **Инициализируйте проект**
   ```bash
   railway init
   ```

4. **Добавьте PostgreSQL**
   ```bash
   railway add postgresql
   ```

5. **Установите переменные окружения**
   ```bash
   railway variables set TELEGRAM_TOKEN=your_bot_token_here
   ```

6. **Задеплойте**
   ```bash
   railway up
   ```

## Переменные окружения

Railway автоматически установит следующие переменные:

- `DATABASE_URL` - автоматически создается при добавлении PostgreSQL
- `PORT` - автоматически устанавливается Railway

Вам нужно добавить только:

- `TELEGRAM_TOKEN` - токен вашего Telegram бота

## Мониторинг

### Логи

Просматривайте логи в реальном времени:
```bash
railway logs
```

Или в веб-интерфейсе Railway в разделе "Deployments".

### Health Check

Бот включает встроенный health check endpoint:
- `https://your-app.railway.app/health` - статус здоровья приложения
- `https://your-app.railway.app/` - то же самое

Пример ответа:
```json
{
  "status": "healthy",
  "database": "connected",
  "timestamp": "2024-01-01T12:00:00.000Z"
}
```

## Структура проекта для Railway

```
telegram-bot/
├── main.py              # Основной код бота
├── requirements.txt     # Python зависимости
├── Procfile            # Команда запуска для Railway
├── runtime.txt         # Версия Python
├── railway.json        # Конфигурация Railway
├── create_tables.sql   # SQL скрипт (опционально)
├── .env.example        # Пример переменных окружения
├── .gitignore          # Исключения для Git
└── README.md           # Основная документация
```

## Автоматические перезапуски

Railway автоматически перезапустит бота в случае:
- Ошибки приложения
- Превышения лимитов памяти
- Сетевых проблем

Настройки перезапуска указаны в `railway.json`:
- Максимум 10 попыток перезапуска
- Перезапуск только при ошибках

## Масштабирование

Railway автоматически масштабирует ресурсы в зависимости от нагрузки:
- CPU: до 8 vCPU
- RAM: до 32 GB
- Хранилище: до 100 GB

## Стоимость

Railway предоставляет:
- $5 бесплатных кредитов в месяц
- Оплата по факту использования
- Автоматическая остановка при превышении лимитов

Примерная стоимость для небольшого бота: $1-3 в месяц.

## Устранение неполадок

### Бот не запускается

1. Проверьте логи: `railway logs`
2. Убедитесь, что `TELEGRAM_TOKEN` установлен
3. Проверьте, что PostgreSQL сервис запущен

### Бот не получает сообщения

1. Убедитесь, что Privacy Mode отключен в @BotFather
2. Проверьте, что бот добавлен в групповые чаты
3. Убедитесь, что токен корректен

### Ошибки базы данных

1. Проверьте, что PostgreSQL сервис работает
2. Убедитесь, что `DATABASE_URL` установлен автоматически
3. Проверьте логи на ошибки подключения

### Превышение лимитов

1. Мониторьте использование ресурсов в Railway dashboard
2. Оптимизируйте код для снижения потребления памяти
3. Рассмотрите возможность увеличения лимитов

## Обновление бота

### Через GitHub

1. Внесите изменения в код
2. Закоммитьте и запушьте в GitHub
3. Railway автоматически пересоберет и задеплоит

### Через CLI

```bash
railway up
```

## Безопасность

1. **Никогда не коммитьте токены** в Git
2. Используйте переменные окружения для всех секретов
3. Регулярно ротируйте токены ботов
4. Мониторьте логи на подозрительную активность

## Резервное копирование

Railway автоматически создает резервные копии PostgreSQL:
- Ежедневные автоматические бэкапы
- Возможность восстановления на любую точку времени
- Экспорт данных в различных форматах

## Поддержка

- [Railway Documentation](https://docs.railway.app/)
- [Railway Discord](https://discord.gg/railway)
- [GitHub Issues](https://github.com/railwayapp/railway/issues)